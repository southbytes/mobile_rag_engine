# v0.3.0 - Prompt Compression & Context Optimization

This release introduces intelligent prompt compression for sLLM (small Language Models) optimization, along with significant improvements to RAG context handling.

## üöÄ Key Features

### 1. Prompt Compression (REFRAG-inspired)
Lightweight implementation inspired by the REFRAG paper to optimize context for on-device sLLMs like Gemma Nano.

| Feature | Description |
|---------|-------------|
| **Duplicate Sentence Removal** | Hash-based detection removes exact duplicate sentences |
| **Sentence Splitting** | Unicode-aware splitting for Korean/English |
| **Token Budget Control** | Truncate context to fit LLM token limits |

```dart
import 'package:mobile_rag_engine/mobile_rag_engine.dart';

final result = await compressText(
  text: longContext,
  maxChars: 8000,
  options: CompressionOptions(
    removeDuplicates: true,
    language: 'ko',
    level: 1,
  ),
);
```

### 2. Improved Prompt Format
Enhanced system prompts for better sLLM comprehension:
- Bilingual instructions (Korean + English)
- Strict mode: "Answer ONLY from provided documents"
- Clear document boundaries (`--- Ï∞∏Í≥† Î¨∏ÏÑú ---`)

### 3. Semantic Chunking Enhancement
- **Article Pattern Detection**: Korean legal document patterns (`Ï†úXÏ°∞`) now split correctly
- **Paragraph-First Strategy**: Prioritizes `\n\n` breaks over sentence boundaries

### 4. Hybrid Search (BM25 + Vector)
- Reciprocal Rank Fusion (RRF) for combining keyword and semantic search
- Better results for exact term matching + semantic understanding

## ‚ö†Ô∏è Breaking Changes

### Stopword Filtering Removed
The stopword removal feature has been **removed** from compression:

```dart
// ‚ùå No longer has effect (always false internally)
CompressionOptions(removeStopwords: true)

// ‚úÖ Use duplicate removal instead
CompressionOptions(removeDuplicates: true)
```

**Reason**: Stopword removal damages context and meaning. Modern LLM systems use perplexity-based (LLMLingua) or embedding-based (REFRAG) methods instead of primitive word filtering.

## üì¶ New Files

| File | Purpose |
|------|---------|
| `compression_utils.rs` | Rust compression pipeline |
| `prompt_compressor.dart` | Dart compression API |
| `ContextBuilder.buildWithCompression()` | Integrated compression |

## üõ† Improvements

- Fixed compression ratio display (now shows `-X%` reduction)
- Added debug logging for compression statistics
- Improved RAG chat screen with compression level selector
- Better token budget management for sLLM context windows

## üìä Compression Levels

| Level | Value | Description |
|-------|-------|-------------|
| Minimal | 0 | Duplicate removal only |
| Balanced | 1 | + Reasonable char limit |
| Aggressive | 2 | + Strict char limit |

## üîÆ Roadmap

Future versions may include:
- **LLMLingua-style** perplexity-based compression
- **Chunk embedding pre-computation** for faster inference
- **Context distillation** via summarization models
